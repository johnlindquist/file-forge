#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Block direct pushes to main (optional but recommended)
current_branch=$(git symbolic-ref --short HEAD)
if [ "$current_branch" = "main" ]; then
  echo "Direct pushes to the main branch are not allowed."
  echo "Please submit a Pull Request."
  exit 1
fi

echo "Running pre-push checks (tests)..."

# Ensure pnpm is available
if ! command -v pnpm &> /dev/null; then
    echo "pnpm could not be found, please install it."
    exit 1
fi

# Run tests
pnpm test --passWithNoTests

if [ $? -ne 0 ]; then
  echo "Pre-push checks failed (tests)."
  exit 1
fi

echo "Pre-push checks passed."
exit 0 