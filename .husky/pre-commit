#!/bin/sh

# Skip checks in CI environments
if [ -z "$CI" ]; then
  # Prevent committing to main branch
  branch="$(git symbolic-ref --short HEAD)"
  if [ "$branch" = "main" ]; then
    echo "‚ùå You can't commit directly to the main branch!"
    echo "Please create a feature branch and use pull requests instead."
    exit 1
  fi

  # Install deps, lint, type check, test
  pnpm install && \
  pnpm eslint . --fix --max-warnings 0 && \
  pnpm tsc --noEmit --strict && \
  pnpm test
fi
